<div class="upload-container">
    <header class="wedding-header">
        <h1>Comparte tus momentos</h1>
        <p>Sube tus fotos y videos de esta celebraci√≥n especial</p>
    </header>

    <form [formGroup]="uploadForm" (ngSubmit)="onSubmit()" class="upload-form">
        <!-- Nombre del invitado -->
        <div class="form-group">
            <label for="guestName">Tu nombre:</label>
            <input type="text" id="guestName" formControlName="guestName" placeholder="Escribe tu nombre"
                class="form-control">
            <div *ngIf="uploadForm.get('guestName')?.invalid && uploadForm.get('guestName')?.touched"
                class="error-message">
                Por favor, escribe tu nombre
            </div>
        </div>

        <!-- Selector de archivos m√∫ltiples -->
        <div class="form-group file-input-container">
            <label for="files" class="file-input-label">
                <span *ngIf="selectedFiles.length === 0">Selecciona fotos y videos</span>
                <span *ngIf="selectedFiles.length === 1">1 archivo seleccionado</span>
                <span *ngIf="selectedFiles.length > 1">{{ selectedFiles.length }} archivos seleccionados</span>
                <small class="file-limit-info">M√°ximo {{ MAX_FILES }} archivos, 1GB cada uno</small>
            </label>
            <input type="file" id="files" (change)="onFilesSelected($event)" 
                accept=".jpg,.jpeg,.png,.mp4,.mov" multiple
                class="file-input" #fileInput>
        </div>

        <!-- Lista de archivos seleccionados -->
        <div *ngIf="selectedFiles.length > 0" class="selected-files-container">
            <div class="selected-files-header">
                <h3>Archivos seleccionados:</h3>
                <button type="button" class="remove-all-btn" (click)="removeAllFiles()" 
                    [disabled]="isUploading" title="Remover todos los archivos">
                    üóëÔ∏è Limpiar todo
                </button>
            </div>

            <div class="files-grid">
                <div *ngFor="let fileItem of selectedFiles" class="file-item" [ngClass]="getFileStatusClass(fileItem)">
                    <!-- Previsualizaci√≥n -->
                    <div class="file-preview-container">
                        <img *ngIf="!fileItem.isVideo && fileItem.previewUrl" 
                            [src]="fileItem.previewUrl" alt="Preview" class="file-preview">
                        <video *ngIf="fileItem.isVideo && fileItem.previewUrl" 
                            [src]="fileItem.previewUrl" class="file-preview" muted></video>
                        <div *ngIf="!fileItem.previewUrl" class="file-preview-placeholder">
                            <span>{{ fileItem.isVideo ? 'üé•' : 'üñºÔ∏è' }}</span>
                        </div>
                    </div>

                    <!-- Informaci√≥n del archivo -->
                    <div class="file-info">
                        <div class="file-name" [title]="fileItem.file.name">
                            <span class="file-status-icon">{{ getFileStatusIcon(fileItem) }}</span>
                            {{ fileItem.file.name }}
                        </div>
                        <div class="file-size">
                            {{ (fileItem.file.size / 1024 / 1024) | number:'1.1-1' }} MB
                        </div>
                        
                        <!-- Progreso individual del archivo -->
                        <div *ngIf="fileItem.uploadStatus === 'uploading'" class="file-progress">
                            <div class="progress-bar-small">
                                <div class="progress-fill" [style.width.%]="fileItem.uploadProgress"></div>
                            </div>
                            <span class="progress-text">{{ fileItem.uploadProgress }}%</span>
                        </div>

                        <!-- Error espec√≠fico del archivo -->
                        <div *ngIf="fileItem.uploadError" class="file-error">
                            {{ fileItem.uploadError }}
                        </div>
                    </div>

                    <!-- Bot√≥n para remover archivo individual -->
                    <button type="button" class="remove-file-btn" (click)="removeFile(fileItem.id)"
                        [disabled]="isUploading" title="Remover archivo">
                        ‚úï
                    </button>
                </div>
            </div>
        </div>

        <!-- Mensajes de error globales -->
        <div *ngIf="uploadError" class="error-message">
            {{ uploadError }}
        </div>

        <!-- Progreso global de carga -->
        <div *ngIf="isUploading" class="progress-container">
            <div class="progress-label">Subiendo archivos...</div>
            <div class="progress-bar" [style.width.%]="globalUploadProgress">
                {{ globalUploadProgress }}%
            </div>
        </div>

        <!-- Mensaje de √©xito -->
        <div *ngIf="allFilesUploaded" class="success-message">
            <span class="success-icon">‚úì</span>
            ¬°Todos los archivos se subieron con √©xito! Gracias por compartirlos.
        </div>

        <!-- Botones de acci√≥n -->
        <div class="button-container">
            <button type="submit" class="submit-button" 
                [disabled]="uploadForm.invalid || selectedFiles.length === 0 || isUploading">
                <span *ngIf="!isUploading">Subir {{ selectedFiles.length }} archivo(s)</span>
                <span *ngIf="isUploading">Subiendo...</span>
            </button>

            <button type="button" class="reset-button" (click)="resetForm()" [disabled]="isUploading">
                Cancelar
            </button>
        </div>
    </form>

    <footer class="app-footer">
        <p>Gracias por ser parte de este d√≠a especial</p>
        <div class="hearts">
            <span>‚ù§</span>
            <span>‚ù§</span>
            <span>‚ù§</span>
        </div>
    </footer>
</div>